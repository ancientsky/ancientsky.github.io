import React, { useState, useEffect } from 'react';
import { 
  Sword, 
  Shield, 
  Skull, 
  Activity, 
  AlertTriangle, 
  UserX, 
  CheckCircle, 
  ChevronRight, 
  ChevronLeft,
  Microscope,
  Zap
} from 'lucide-react';

// Slide Content Data
const slides = [
  {
    id: 'intro',
    type: 'title',
    title: 'å¾®è§€ä¸–ç•Œçš„é€†è¥²',
    subtitle: 'ç•¶ç´°èŒç©¿ä¸Šé‹¼éµäººè£ç”²ï¼šæŠ—ç”Ÿç´ æŠ—è—¥æ€§',
    icon: <Skull size={64} className="text-red-500 animate-bounce" />,
    bg: 'bg-slate-900'
  },
  {
    id: 'enemy',
    type: 'content',
    title: 'èªæ¸…ä½ çš„æ•µäºº',
    content: 'æ„Ÿå†’é€šå¸¸æ˜¯ã€Œç—…æ¯’ã€å¼•èµ·çš„ï¼ŒæŠ—ç”Ÿç´ åªæ®ºã€Œç´°èŒã€ï¼',
    subContent: 'ç”¨æŠ—ç”Ÿç´ æ®ºç—…æ¯’ï¼Œå°±åƒç”¨ç‰©ç†æ”»æ“Šæ‰“é¬¼é­‚ï¼Œå®Œå…¨ç„¡æ•ˆå•Šï¼ğŸ‘»',
    visual: 'vs',
    bg: 'bg-indigo-900'
  },
  {
    id: 'weapon',
    type: 'content',
    title: 'äººé¡çš„ç§˜å¯†æ­¦å™¨ï¼šæŠ—ç”Ÿç´ ',
    content: 'æŠ—ç”Ÿç´ æ˜¯ç´°èŒçš„ç‹™æ“Šæ‰‹ã€‚',
    subContent: 'è‡ªå¾ 1928 å¹´ç›¤å°¼è¥¿æ—ç™¼ç¾å¾Œï¼Œäººé¡ä»¥ç‚ºè‡ªå·±ç„¡æ•µäº†... ä½†æˆ‘å€‘å¤ªå¤©çœŸäº†ã€‚',
    icon: <Sword size={48} className="text-yellow-400" />,
    bg: 'bg-blue-900'
  },
  {
    id: 'evolution',
    type: 'simulation',
    title: 'ç´°èŒçš„ä¿®ç·´å ´ï¼šæŠ—è—¥æ€§æ˜¯æ€éº¼ä¾†çš„ï¼Ÿ',
    content: 'é€™å°±åƒæ˜¯ç´°èŒçš„ã€Œå¤§é€ƒæ®ºã€éŠæˆ²ã€‚',
    subContent: 'æ´»ä¸‹ä¾†çš„é‚£å€‹ 1%ï¼Œå°±æ˜¯æœ€å¼·çš„èè‹±æ€ª (BOSS)ã€‚',
    bg: 'bg-gray-900'
  },
  {
    id: 'mistake',
    type: 'content',
    title: 'äººé¡çš„è‡ªæ®ºè¡Œç‚º (éŒ¯èª¤ç¤ºç¯„)',
    content: 'ã€Œæˆ‘è¦ºå¾—å¥½å¤šäº†ï¼Œè—¥å°±ä¸åƒäº†å§ï¼Ÿã€',
    subContent: 'é€™æ˜¯æœ€å±éšªçš„ä¸€å¥è©±ï¼ä½ æ’¤é€€äº†ï¼Œå‰©ä¸‹çš„ç´°èŒå°±é–‹é¦™æª³æ…¶ç¥ï¼Œç„¶å¾Œå‡ç´šè£å‚™ã€‚',
    icon: <UserX size={48} className="text-orange-500" />,
    bg: 'bg-red-900'
  },
  {
    id: 'future',
    type: 'content',
    title: 'å¦‚æœæˆ‘å€‘è¼¸äº†...',
    content: 'æ­¡è¿ä¾†åˆ°ã€Œç„¡è—¥å¯é†«ã€çš„æ™‚ä»£ã€‚',
    subContent: 'ç°¡å–®çš„æ“¦å‚·å¯èƒ½æœƒè‡´å‘½ï¼Œç›²è…¸ç‚è®Šæˆçµ•ç—‡ã€‚æˆ‘å€‘å°‡å›åˆ°ä¸­ä¸–ç´€ã€‚ğŸ°',
    icon: <AlertTriangle size={48} className="text-yellow-500" />,
    bg: 'bg-slate-800'
  },
  {
    id: 'action',
    type: 'list',
    title: 'ä½ çš„æˆ°é¬¥æº–å‰‡ (å››ä¸åŸå‰‡)',
    items: [
      'ä¸ä¸»å‹•è¦æ±‚æŠ—ç”Ÿç´ ',
      'ä¸éš¨ä¾¿è‡ªå·±è²·æŠ—ç”Ÿç´ ',
      'ä¸åƒåˆ¥äººçš„æŠ—ç”Ÿç´ ',
      'ä¸éš¨ä¾¿åœè—¥ (é†«ç”Ÿèªªåœæ‰åœ)'
    ],
    bg: 'bg-green-900'
  },
  {
    id: 'end',
    type: 'title',
    title: 'æˆç‚ºè°æ˜çš„æŒ‡æ®å®˜',
    subtitle: 'ä¿è­·æŠ—ç”Ÿç´ ï¼Œå°±æ˜¯ä¿è­·æœªä¾†çš„è‡ªå·±ï¼',
    icon: <CheckCircle size={64} className="text-green-400" />,
    bg: 'bg-slate-900'
  }
];

export default function App() {
  const [currentSlide, setCurrentSlide] = useState(0);
  const [bacteria, setBacteria] = useState(Array(12).fill({ status: 'normal' }));
  const [simStep, setSimStep] = useState(0); // 0: init, 1: attack, 2: survivors, 3: mutate

  // Keyboard navigation
  useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === 'ArrowRight') nextSlide();
      if (e.key === 'ArrowLeft') prevSlide();
    };
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [currentSlide]);

  const nextSlide = () => {
    if (currentSlide < slides.length - 1) setCurrentSlide(c => c + 1);
  };

  const prevSlide = () => {
    if (currentSlide > 0) setCurrentSlide(c => c - 1);
  };

  // Simulation Logic
  const runSimulation = () => {
    if (simStep === 0) {
      // Step 1: Attack - kill most
      setBacteria(prev => prev.map((b, i) => 
        i % 4 !== 0 ? { ...b, status: 'dead' } : b
      ));
      setSimStep(1);
    } else if (simStep === 1) {
      // Step 2: Mutate - survivors become superbugs
      setBacteria(prev => prev.map(b => 
        b.status !== 'dead' ? { ...b, status: 'super' } : b
      ));
      setSimStep(2);
    } else if (simStep === 2) {
      // Step 3: Regrow - superbugs multiply
      setBacteria(Array(12).fill({ status: 'super' }));
      setSimStep(3);
    } else {
      // Reset
      setBacteria(Array(12).fill({ status: 'normal' }));
      setSimStep(0);
    }
  };

  const renderSlide = () => {
    const slide = slides[currentSlide];

    // Common Container
    const Container = ({ children }) => (
      <div className={`flex flex-col items-center justify-center h-full w-full p-8 text-center transition-colors duration-500 ${slide.bg} text-white overflow-hidden relative`}>
        {/* Background Patterns */}
        <div className="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none overflow-hidden">
          <div className="absolute top-10 left-10 w-20 h-20 rounded-full bg-white blur-xl animate-pulse"></div>
          <div className="absolute bottom-20 right-10 w-32 h-32 rounded-full bg-purple-500 blur-xl animate-pulse" style={{animationDelay: '1s'}}></div>
        </div>
        
        <div className="z-10 max-w-4xl w-full">
          {children}
        </div>
      </div>
    );

    if (slide.type === 'title') {
      return (
        <Container>
          <div className="mb-8 animate-bounce-slow">{slide.icon}</div>
          <h1 className="text-5xl md:text-7xl font-black mb-4 text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
            {slide.title}
          </h1>
          <p className="text-xl md:text-3xl text-gray-300 font-light">
            {slide.subtitle}
          </p>
          <button 
            onClick={nextSlide}
            className="mt-12 px-8 py-3 bg-blue-600 hover:bg-blue-500 rounded-full text-white font-bold transition-transform active:scale-95 shadow-lg animate-pulse"
          >
            é–‹å§‹æˆ°é¬¥
          </button>
        </Container>
      );
    }

    if (slide.type === 'content') {
      return (
        <Container>
          <h2 className="text-4xl md:text-5xl font-bold mb-8 text-yellow-300">{slide.title}</h2>
          
          {slide.visual === 'vs' ? (
            <div className="flex flex-col md:flex-row items-center justify-center gap-8 mb-8 w-full">
              <div className="bg-red-800/50 p-6 rounded-xl border-2 border-red-500 w-full md:w-1/2">
                <div className="text-6xl mb-2">ğŸ¦ </div>
                <h3 className="text-2xl font-bold text-red-300">ç´°èŒ (Bacteria)</h3>
                <p className="text-sm text-gray-300 mt-2">æ´»çš„å–®ç´°èƒç”Ÿç‰©</p>
                <div className="mt-4 bg-red-600 text-white px-2 py-1 rounded text-sm font-bold">æŠ—ç”Ÿç´ æœ‰æ•ˆ âœ…</div>
              </div>
              <div className="text-4xl font-black text-white">VS</div>
              <div className="bg-gray-700/50 p-6 rounded-xl border-2 border-gray-500 w-full md:w-1/2 opacity-50 grayscale">
                <div className="text-6xl mb-2">ğŸ‘»</div>
                <h3 className="text-2xl font-bold text-gray-300">ç—…æ¯’ (Virus)</h3>
                <p className="text-sm text-gray-300 mt-2">éç”Ÿç‰©ï¼Œåƒé¬¼é­‚</p>
                <div className="mt-4 bg-gray-600 text-white px-2 py-1 rounded text-sm font-bold">æŠ—ç”Ÿç´ ç„¡æ•ˆ âŒ</div>
              </div>
            </div>
          ) : (
             <div className="mb-8">{slide.icon}</div>
          )}

          <p className="text-2xl md:text-4xl font-bold mb-6 leading-relaxed">
            {slide.content}
          </p>
          <div className="bg-black/30 p-6 rounded-lg border-l-4 border-yellow-400 text-left">
             <p className="text-xl text-gray-200 italic">"{slide.subContent}"</p>
          </div>
        </Container>
      );
    }

    if (slide.type === 'simulation') {
      return (
        <Container>
          <h2 className="text-3xl md:text-4xl font-bold mb-4 text-green-300">{slide.title}</h2>
          
          {/* Simulation Box */}
          <div className="bg-slate-800 p-6 rounded-xl shadow-inner mb-6 w-full max-w-2xl mx-auto border border-slate-600">
             <div className="grid grid-cols-4 gap-4 mb-4 h-48 items-center justify-items-center">
                {bacteria.map((b, idx) => (
                  <div 
                    key={idx} 
                    className={`
                      transition-all duration-500 transform
                      ${b.status === 'dead' ? 'opacity-0 scale-0' : 'opacity-100 scale-100'}
                    `}
                  >
                    {b.status === 'normal' && (
                      <div className="w-10 h-10 bg-green-500 rounded-full animate-bounce shadow-[0_0_10px_#22c55e]" style={{animationDelay: `${idx * 0.1}s`}}>
                        <div className="w-full h-full flex items-center justify-center text-xs font-bold text-green-900">å¼±</div>
                      </div>
                    )}
                    {b.status === 'super' && (
                      <div className="w-12 h-12 bg-red-600 rounded-md animate-pulse shadow-[0_0_15px_#dc2626] border-2 border-yellow-400 rotate-45">
                        <div className="w-full h-full flex items-center justify-center -rotate-45 text-lg">ğŸ˜ˆ</div>
                      </div>
                    )}
                  </div>
                ))}
             </div>
             <div className="flex justify-between items-center bg-slate-900 p-3 rounded-lg">
                <div className="text-sm text-gray-400">
                  ç‹€æ…‹: {simStep === 0 ? 'æ„ŸæŸ“åˆæœŸ (æ™®é€šç´°èŒ)' : 
                         simStep === 1 ? 'æŠ—ç”Ÿç´ æ”»æ“Š (æ®ºæ­»å¼±è€…)' : 
                         simStep === 2 ? 'çªè®Š (å¼·è€…ç”Ÿå­˜)' : 'å¤§åæ’² (å…¨æ˜¯è¶…ç´šç´°èŒ)'}
                </div>
                <button 
                  onClick={runSimulation}
                  className="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded text-sm font-bold transition-colors"
                >
                  {simStep === 3 ? 'é‡ç½®' : 'ä¸‹ä¸€æ­¥'}
                </button>
             </div>
          </div>

          <p className="text-xl text-gray-300">
            {simStep === 3 ? 
              <span className="text-red-400 font-bold blink">ç³Ÿç³•ï¼ç¾åœ¨æŠ—ç”Ÿç´ å°å®ƒå€‘å®Œå…¨æ²’ç”¨äº†ï¼</span> : 
              slide.subContent
            }
          </p>
        </Container>
      );
    }

    if (slide.type === 'list') {
      return (
        <Container>
          <h2 className="text-4xl font-bold mb-8 text-green-400">{slide.title}</h2>
          <div className="grid gap-4 w-full max-w-2xl text-left">
            {slide.items.map((item, idx) => (
              <div 
                key={idx} 
                className="bg-white/10 p-4 rounded-xl flex items-center transform transition hover:scale-105 hover:bg-white/20 cursor-pointer"
              >
                <div className="bg-red-500 w-10 h-10 rounded-full flex items-center justify-center font-bold mr-4 text-xl shadow-lg">
                  NO
                </div>
                <span className="text-2xl font-bold text-white">{item}</span>
              </div>
            ))}
          </div>
        </Container>
      );
    }

    return null;
  };

  return (
    <div className="w-full h-screen bg-black font-sans overflow-hidden relative selection:bg-pink-500 selection:text-white">
      {/* Navigation Buttons (Visible on hover) */}
      <button 
        onClick={prevSlide}
        disabled={currentSlide === 0}
        className="absolute left-4 top-1/2 -translate-y-1/2 z-50 p-2 bg-white/10 hover:bg-white/30 rounded-full text-white disabled:opacity-0 transition-all"
      >
        <ChevronLeft size={40} />
      </button>
      
      <button 
        onClick={nextSlide}
        disabled={currentSlide === slides.length - 1}
        className="absolute right-4 top-1/2 -translate-y-1/2 z-50 p-2 bg-white/10 hover:bg-white/30 rounded-full text-white disabled:opacity-0 transition-all"
      >
        <ChevronRight size={40} />
      </button>

      {/* Progress Bar */}
      <div className="absolute bottom-0 left-0 w-full h-2 bg-gray-800 z-50">
        <div 
          className="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300"
          style={{ width: `${((currentSlide + 1) / slides.length) * 100}%` }}
        ></div>
      </div>

      {/* Main Content */}
      {renderSlide()}
      
      {/* Footer hint */}
      <div className="absolute bottom-4 w-full text-center text-gray-500 text-xs pointer-events-none">
        ä½¿ç”¨éµç›¤ â† â†’ æ“æ§ | Slide {currentSlide + 1} / {slides.length}
      </div>
    </div>
  );
}
